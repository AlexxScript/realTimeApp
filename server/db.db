in docker: docker run --name realTimeP -p 5432:5432 -e POSTGRES_PASSWORD=mysecretpassword -d postgres

CREATE DATABASE school_cafeteria;

\c school_cafeteria;

CREATE TABLE school (
    id_school SERIAL PRIMARY KEY,
    school_name VARCHAR(100),
    password_school VARCHAR(100)
);

CREATE TABLE users (
    id_users SERIAL PRIMARY KEY,
    email_users VARCHAR(200) UNIQUE,
    users_name VARCHAR(200) UNIQUE,
    role VARCHAR(100),
    password VARCHAR(100),
    school_id INT REFERENCES school(id_school) ON DELETE CASCADE
);

CREATE TABLE orders (
    id_orders SERIAL PRIMARY KEY,
    user_id INT,
    school_id INT,
    orders_content TEXT,
    orders_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    total_amount DECIMAL(10, 2),
    is_completed BOOLEAN DEFAULT FALSE,
    FOREIGN KEY (user_id) REFERENCES users(id_users),
    FOREIGN KEY (school_id) REFERENCES school(id_school)
);

CREATE TABLE menu_items (
    id_item SERIAL PRIMARY KEY,
    item_name VARCHAR(200),
    description TEXT,
    price DECIMAL(10,2),
    available BOOLEAN DEFAULT TRUE,
    school_id INT REFERENCES school(id_school),
    user_id INT REFERENCES users(id_users)
);

CREATE TABLE orders_items (
    orders_id_item SERIAL PRIMARY KEY,
    id_orders INT,
    id_item INT,
    quantity INT,
    FOREIGN KEY (id_orders) REFERENCES orders(id_orders),
    FOREIGN KEY (id_item) REFERENCES menu_items(id_item)
);

ALTER TABLE menu_items DROP COLUMN user_id;

 ALTER TABLE menu_items ADD COLUMN quantity INT;

 ALTER DATABASE school_cafeteria
SET TIMEZONE TO 'America/Mexico_City';

SELECT total_amount FROM orders WHERE DATE(orders_time)='2024-02-02';
CREATE TYPE is_completed AS ENUM ('FALSE', 'PICKED', 'COMPLETED');
ALTER TABLE orders ALTER COLUMN is_completed TYPE is_completed USING is_completed::is_completed;
ALTER TABLE orders ADD COLUMN is_completed_temp is_completed;
UPDATE orders
SET is_completed_temp = CASE
    WHEN is_completed = FALSE THEN 'FALSE'
    WHEN is_completed = TRUE THEN 'COMPLETED'
    ELSE NULL  -- Maneja otros casos si es necesario
END;
ALTER TABLE orders DROP COLUMN is_completed;
ALTER TABLE orders RENAME COLUMN is_completed_temp TO is_completed;
ALTER TABLE orders ALTER COLUMN is_completed SET DEFAULT 'FALSE';
